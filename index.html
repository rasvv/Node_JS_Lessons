<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Socket</title>
    <script src="https://cdn.socket.io/4.2.0/socket.io.min.js" integrity="sha384-PiBR5S00EtOj2Lto9Uu81cmoyZqR57XcOna1oAuVuIEjzj0wpqDVfD0JA9eXlRsj" crossorigin="anonymous"></script>
</head>
<body>
	<div class="messageblock">
    <p id="usernick"> Автор </p>
    <p id="clientsCount"> Пользователей </p>
		<input class="input" id="input" type="text" autofocus>
		<button class="button" id="button">Send</button>
		<div class="messages" id="messages"></div>
	</div>

	<script>
	    const socket = io('localhost:8082')
	    const messageOutput = document.getElementById('messages')
	    const sendButton = document.getElementById('button')
	    const input = document.getElementById('input')
	    const userNick = document.getElementById('usernick')
	    const clientscount = document.getElementById('clientsCount')

        const generateNick = () => {
            // const uppercharacters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            const characters = 'abcdefghijklmnopqrstuvwxyz'
            let result = ''
            for ( let i = 0; i < 4; i++ ) {
                result += characters.charAt(Math.floor(Math.random() * characters.length))
                if (i === 0) result = result.toUpperCase()
            }
            return result;
        }

        const nick = generateNick()
        
        const sendMessage = (message) => {
            const data = {
                message: message,
                nick,
            }
            socket.emit('client-msg', data)    
        } 

        socket.on('connect', () => {
            userNick.innerHTML = `Текущий пользователь: <b>${nick}</b>`
						socket.emit('client-on', nick)  
	    });

	    sendButton.onclick = () => {
	        sendMessage(input.value)
	    }

	    socket.on('server-msg', ({ message, nick, clientsCount }) => {
				messageOutput.insertAdjacentHTML('beforeend', `<p>${new Date().toLocaleTimeString()} Автор: <b>${nick}</b> Сообщение: <b>${message}</b></p>`)
				clientscount.innerHTML = `Пользователей в чате: <b>${clientsCount}</b>`
			})
	</script>
</body>
<style>
	b {
		font-weight: bold;
	}
</style>
</html>
