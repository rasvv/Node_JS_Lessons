<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Socket</title>
    <script src="https://cdn.socket.io/4.2.0/socket.io.min.js" integrity="sha384-PiBR5S00EtOj2Lto9Uu81cmoyZqR57XcOna1oAuVuIEjzj0wpqDVfD0JA9eXlRsj" crossorigin="anonymous"></script>
</head>
<body>
	<div class="messageblock">
        <p id="usernick"> Автор </p>
		<input class="input" id="input" type="text" autofocus>
		<button class="button" id="button">Send</button>
		<div class="messages" id="messages"></div>
	</div>

	<script>
	    const socket = io('localhost:8082')
	    const messageOutput = document.getElementById('messages')
	    const sendButton = document.getElementById('button')
	    const input = document.getElementById('input')
	    const userNick = document.getElementById('usernick')

        const generateNick = () => {
            // const uppercharacters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            const characters = 'abcdefghijklmnopqrstuvwxyz'
            let result = ''
            for ( let i = 0; i < 4; i++ ) {
                result += characters.charAt(Math.floor(Math.random() * characters.length))
                if (i === 0) result = result.toUpperCase()
            }
            return result;
        }

        const nick = generateNick()

        console.log(nick)
        //  generateNick(process.pid)

        
        const sendMessage = (message) => {
            const data = {
                message: message,
                nick,
            }
            // socket.broadcast.emit('client-msg', data)
            socket.emit('client-msg', data)    
        } 



        socket.on('connect', () => {
	        console.log('Client connected')
            userNick.innerHTML = `Автор: ${nick}`
            sendMessage(`I'm in chat!`)
	    });

        socket.on('close', () => {
            sendMessage(`Goodby!`)
	    });

	    // socket.emit('client-msg', 'test');

	    sendButton.onclick = () => {
	        console.log('onclick: ' + input.value)
	        sendMessage(input.value)


	        // socket.broadcast.emit('client-msg', data)
            // socket.emit('client-msg', 'test');
	    }

	    socket.on('server-msg', ({ message, nick }) => {
				// console.log(messageOutput);
				messageOutput.insertAdjacentHTML('beforeend', `<p>Автор: ${nick}</p> <p>Сообщение: ${message}</p>`)
	    })
	</script>
</body>
<style>
	/* body {
		display: grid;
		grid-template-columns: repeat(8, 1fr);
	}
	.messages {
		border: 1px solid #000;
		height: 50px;
	} */

</style>
</html>
